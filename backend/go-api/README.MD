# Sample Go API for Compound Interest
This is not complete until merged to master.

This is a basic example of a Golang based WebAPI which can be used for the backend of the Trahan Compound frontend. I installed swagger which is what I'm used to using for documentation/troubleshooting in C#/.NET. 

This is the first thing I've ever built in Golang, so I'm sure there's plenty of room for improvement. I'm not finished enough to merge yet, but I've got everything compiling and swagger working. I ChatGPTed a bare skeleton to get started and start to working my way through docs. I've always found the fastest way I learn a new language is to get my hands on a bad codebase and start questioning and improving it.

## Setup for Swagger
I followed many...many different guides to get setup swagger setup properly with  golang's net/http. I'm used to .NET 6+ , where swagger is automatically configured for you when you create a WebAPI project, so I may have still missed some things or configured it here in a non-ideal way. But, it seems to be working correctly. I prefer to avoid third party depsendencies when possible and a lot of the guides I found were centered aroun Gin. They also mostly covered the Go swag utility, which parses your comments and generates the swagger.json and yaml files. While this is an important component, I wanted the UI available for local developement. Just about every guide that I can remember, left out the fact that you need to manually copy ./dist directory from the swagger-ui github repo to get the swagger-ui that gets serverd. These were the two guides I found that helped me the most:

https://linggar.asia/?p=594
 https://medium.com/julotech/implementing-swagger-in-go-projects-8579a5fb955

Thesse were some gotchas that I either missed initially in the guide or weren't mentioned.

### Installing the swag init utility
I'm using the Ubuntu on WSL version 2 and had to run this command set PATH correctly before the `swag init` command would work: 

`export PATH=$(go env GOPATH)/bin:$PATH`

### Setting up the swagger-ui portion
As mentioned earlier, the swag init utility did not appear to have a way to setupp the inital ui directory. I had to clone down the [swagger-ui](https://github.com/swagger-api/swagger-ui) and copy all of the files into a direcory inside the main module. I just created directory named `swagger` inside the root of the main Go module:

```

├── README.MD
├── docs
│   ├── docs.go
│   ├── swagger.json
│   └── swagger.yaml
├── go.mod
├── go.sum
├── main.go
└── swagger
    ├── docs.go
    ├── favicon-16x16.png
    ├── favicon-32x32.png
    ├── index.css
    ├── index.html
    ├── oauth2-redirect.html
    ├── swagger-initializer.js
    ├── swagger-ui-bundle.js
    ├── swagger-ui-bundle.js.map
    ├── swagger-ui-es-bundle-core.js
    ├── swagger-ui-es-bundle-core.js.map
    ├── swagger-ui-es-bundle.js
    ├── swagger-ui-es-bundle.js.map
    ├── swagger-ui-standalone-preset.js
    ├── swagger-ui-standalone-preset.js.map
    ├── swagger-ui.css
    ├── swagger-ui.css.map
    ├── swagger-ui.js
    ├── swagger-ui.js.map
    ├── swagger.json
    └── swagger.yaml 
```

Obviously, I also needed to create a route that listens for requests to that path. 

`http.HandleFunc("/swagger/", httpSwagger.WrapHandler)`

#### Generating the docs in the proper location

By default, swag init generates the swagger.json and .yaml diles in a directory named docs inside ./

But, the UI will need to reference the swagger.json file, so whe I ran the swag init, I just specified an alternet output:

`swag init -o ./swagger/`

### Tell swagger-initializer.js where swagger.json is located
I had to set the url: paramter to be passed to the SwaggerUIBundle() function in swagger-initializer.js, I've just set it to localhost:8080/swagger/swagger.json for now. 

My gut tells me there's probably a better way to do this, but for my local dev setup (VS Code Remote pointed at WSL Ubuntu on Windows 10), it works well enough for to get the API out of the door.


```
window.ui = SwaggerUIBundle({
    url: "http://localhost:8080/swagger/swagger.json",
    dom_id: '#swagger-ui',
    deepLinking: true,
    presets: [
      SwaggerUIBundle.presets.apis,
      SwaggerUIStandalonePreset
    ],
    plugins: [
      SwaggerUIBundle.plugins.DownloadUrl
    ],
    layout: "StandaloneLayout"
  });

```

### Importing the docs package generated by swag init.
This is 100% my fault from being new to the Golang ecosystem and not reading the guides close enough, but the `swag init` utility also generates a go package (docs.go) which needs to be imported wherever the function comments are defined/parsed. I was confused initially that this import command was refering to a local package, as well as the fact that the package name being generated was different than the file name (package name generated as swagger). The final import that got it working correctly was this 

```
import (
	"encoding/json"
	"fmt"
	"log"
	"net/http"
	"strconv"

	_ "github.com/babbage88/go-compound-api/swagger"

	httpSwagger "github.com/swaggo/http-swagger/v2"
)
```

I'm probably missing something basic Go concept, but this works for now.
 

